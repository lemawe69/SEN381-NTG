@page
@model CampusLearnNTG.Pages.AdminDashboardModel
@{
    Layout = "_Layout";
    ViewData["Title"] = "Admin Dashboard";
}

<!-- Bootstrap CSS + Chart.js -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<!-- Navbar -->


<!-- Main Content -->
<div class="container-fluid pt-5 mt-4">
    <div class="px-4 pt-4">
        <h2 class="h4 text-dark mb-3">Admin Dashboard:</h2>

        <!-- User management -->
        <div class="card mb-4 shadow-sm">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="mb-0">User Management</h5>
                    <div class="btn-group btn-group-sm" role="group">
                        <button class="btn btn-outline-secondary">Students</button>
                        <button class="btn btn-outline-secondary">Tutors</button>
                        <button class="btn btn-outline-secondary">Admins</button>
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="table table-borderless align-middle mb-0">
                        <thead>
                            <tr class="small text-muted">
                                <th>#</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th class="text-end">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var user in Model.Users)
                            {
                                <tr>
                                    <td class="small text-muted">@user.Id</td>
                                    <td>@user.Name</td>
                                    <td class="text-muted small">@user.Email</td>
                                    <td class="small text-secondary">@user.Role</td>
                                    <td>
                                        <span class="badge @((user.Status == "Active") ? "bg-success" : user.Status == "Pending" ? "bg-warning text-dark" : "bg-danger")">
                                            @user.Status
                                        </span>
                                    </td>
                                    <td class="text-end">
                                        <button class="btn btn-sm btn-outline-primary">View</button>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- content moderation cards -->
        <div class="row g-3 mb-4">
            <div class="col-lg-6">
                <div class="card h-100 shadow-sm">
                    <div class="card-body">
                        <h6 class="mb-3">Content Moderation — Forum Posts</h6>
                        @foreach (var post in Model.ForumPosts)
                        {
                            <div class="d-flex justify-content-between align-items-start border-bottom py-2">
                                <div>
                                    <div class="fw-semibold">@post.Title</div>
                                    <small class="text-muted">@post.Author • @post.SubmittedAt.ToString("MMM dd, yyyy")</small>
                                </div>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-sm btn-outline-success">Approve</button>
                                    <button class="btn btn-sm btn-outline-danger">Reject</button>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="card h-100 shadow-sm">
                    <div class="card-body">
                        <h6 class="mb-3">Content Moderation — Learning Materials</h6>
                        @foreach (var mat in Model.LearningMaterials)
                        {
                            <div class="d-flex justify-content-between align-items-start border-bottom py-2">
                                <div>
                                    <div class="fw-semibold">@mat.Title</div>
                                    <small class="text-muted">@mat.Type • @mat.UploadedAt.ToString("MMM dd, yyyy")</small>
                                </div>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-sm btn-outline-success">Approve</button>
                                    <button class="btn btn-sm btn-outline-danger">Reject</button>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- analytics area -->
        <div class="card mb-4 shadow-sm">
            <div class="card-body">
                <h6 class="mb-3">Platform Analytics</h6>

                <div class="row g-3">
                    <div class="col-sm-6 col-md-3">
                        <div class="stat-card p-3">
                            <div class="small text-muted">Total Users</div>
                            <div class="h5 mb-0">@Model.Analytics.TotalUsers</div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-md-3">
                        <div class="stat-card p-3">
                            <div class="small text-muted">Active Users</div>
                            <div class="h5 mb-0">@Model.Analytics.ActiveUsers</div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-md-3">
                        <div class="stat-card p-3">
                            <div class="small text-muted">Forum Posts</div>
                            <div class="h5 mb-0">@Model.Analytics.Posts</div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-md-3">
                        <div class="stat-card p-3">
                            <div class="small text-muted">Uploads</div>
                            <div class="h5 mb-0">@Model.Analytics.Uploads</div>
                        </div>
                    </div>
                </div>

                <div class="row mt-3 gy-3">
                    <div class="col-lg-8">
                        <div class="card p-3 h-100">
                            <div class="small text-muted mb-2">User Activity</div>
                            <canvas id="userActivityChart" height="120"></canvas>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="card p-3 h-100">
                            <div class="small text-muted mb-2">Platform Usage</div>
                            <canvas id="platformUsageChart" height="120"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- settings + notifications -->
        <div class="row g-3 mb-5">
            <div class="col-lg-6">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h6 class="mb-3">Platform Settings</h6>
                        <form>
                            <div class="mb-3">
                                <label class="form-label small">Site Title</label>
                                <input class="form-control form-control-sm" value="@Model.Settings.SiteTitle" />
                            </div>
                            <div class="mb-3">
                                <label class="form-label small">Admin Contact Email</label>
                                <input class="form-control form-control-sm" value="@Model.Settings.AdminEmail" />
                            </div>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="toggleRegistration" checked="@Model.Settings.RegistrationOpen" />
                                <label class="form-check-label small" for="toggleRegistration">Allow User Registration</label>
                            </div>
                            <div class="mt-3">
                                <button class="btn btn-sm btn-primary">Save Settings</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="card shadow-sm h-100">
                    <div class="card-body">
                        <h6 class="mb-3">Notifications</h6>
                        <ul class="list-group list-group-flush">
                            @foreach (var n in Model.Notifications)
                            {
                                <li class="list-group-item d-flex justify-content-between align-items-start">
                                    <div>
                                        <div class="fw-semibold">@n.Title</div>
                                        <small class="text-muted">@n.Message</small>
                                    </div>
                                    <small class="text-muted">@n.TimeAgo</small>
                                </li>
                            }
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Chart data (mock). Replace later by fetching REST API results.
    const activityCtx = document.getElementById('userActivityChart');
    if (activityCtx) {
        new Chart(activityCtx, {
            type: 'line',
            data: {
                labels: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Analytics.ActivityLabels)),
                datasets: [{
                    label: 'Active users',
                    data: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Analytics.ActivityData)),
                    tension: 0.3,
                    borderWidth: 2,
                    pointRadius: 0
                }]
            },
            options: {
                plugins: { legend: { display: false } },
                scales: { y: { ticks: { beginAtZero: true } } }
            }
        });
    }

    const usageCtx = document.getElementById('platformUsageChart');
    if (usageCtx) {
        new Chart(usageCtx, {
            type: 'bar',
            data: {
                labels: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Analytics.UsageLabels)),
                datasets: [{ data: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Analytics.UsageData)), borderWidth: 0 }]
            },
            options: { plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
        });
    }
</script>

<style>
    body {
        font-family: 'Inter', sans-serif;
        background-color: #fff;
        padding-top: 75px;
    }

    .navbar-brand {
        font-size: 1.4rem;
    }

    .nav-link {
        font-weight: 500;
        color: #333 !important;
    }

        .nav-link:hover {
            color: #0b5ed7 !important;
        }

    .stat-card {
        background: #fafbff;
        border-radius: 8px;
    }

    .card {
        border-radius: 10px;
    }
</style>
